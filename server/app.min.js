'use strict';var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,f){c.__proto__=f}||function(c,f){for(var g in f)f.hasOwnProperty(g)&&(c[g]=f[g])};return function(c,f){function g(){this.constructor=c}a(c,f),c.prototype=null===f?Object.create(f):(g.prototype=f.prototype,new g)}}(),GameConstants=function(){function a(){}return a.client_name='',a.socket_id='',a}(),Socket=function(){function a(){var c=this;this.url='localhost:3801',this.websocket=null,this.websocket=io.connect(this.url,{reconnection:!1}),this.socketListener('message',function(f){console.log(f)}),this.socketListener('disconnect',function(f){console.log(f),c.websocket.disconnect()})}return a.prototype.sendSocket=function(c,f){this.websocket.emit(c,f)},a.prototype.socketListener=function(c,f){this.websocket.on(c,f)},a}(),GameSettings=function(){return function(c){function g(C){var D=this;console.log('press play'),console.log(C),this.game_start_sfx=this.sound.add('start'),this.move_sfx=this.sound.add('move'),this.lose_sfx=this.sound.add('win'),this.win_sfx=this.sound.add('lose'),this.spectate_text.x=900,this.play_text.x=900,c.socketListener('ready',function(){D.info_text.setText('Searching for players...'),D.info_text.x=10}),c.socketListener('disconnect',function(){D.info_text.setText('Game server is offline')}),c.socketListener('join',function(){D.info_text.x=25,D.info_text.y=510,D.info_text.setText('Setting up game...'),D.board=D.add.image(250,250,'board'),D.x_cursor_icon=D.add.image(900,0,'x'),D.x_previous=D.add.image(900,0,'xG'),D.o_cursor_icon=D.add.image(900,0,'o'),D.o_previous=D.add.image(900,0,'oG'),D.game_start_sfx.play()}),c.socketListener('broken',function(){D.info_text.setText('Disconnected with other session')}),c.socketListener('board-data',function(E){var F=E['Previous-Turn'].split('|')[0]*u/9+u/18,G=E['Previous-Turn'].split('|')[1]*v/9+v/18;-1<E.Message.indexOf('wins')?E[GameConstants.socket_id].Piece==E.Turn?D.lose_sfx.play():D.win_sfx.play():'1'==E.Success&&D.move_sfx.play(),E[GameConstants.socket_id].Piece==E.Turn?(D.place_in_progress=!1,D.info_text.setText('Turn '+E.Turn+'(you) - Move '+E.Move),D.players_turn=!0,D.player_piece=E.Turn,'-'!=E['Previous-Turn']&&('x'==E.Turn?(D.x_cursor_icon.x=D.reapear_location_x,D.x_cursor_icon.y=D.reapear_location_y,D.o_previous.x=F,D.x_previous.x=-100,D.o_previous.y=G,D.x_previous.y=-100):(D.o_cursor_icon.x=D.reapear_location_x,D.o_cursor_icon.y=D.reapear_location_y,D.x_previous.x=F,D.o_previous.x=-100,D.x_previous.y=G,D.o_previous.y=-100))):(D.info_text.setText('Turn '+E.Turn+'(opponent) - Move '+E.Move),D.players_turn=!1,'x'==E.Turn?D.x_cursor_icon.visible=!1:D.o_cursor_icon.visible=!1),''!=E.Message&&D.info_text.setText(E.Message),D.x_board.forEach(function(I,J){D.x_board[J].destroy()}),D.o_board.forEach(function(I,J){D.o_board[J].destroy()});var H=E.Board.split('\n');H.forEach(function(I,J){var K=I.split(' ');K.forEach(function(L,M){J==E['Previous-Turn'].split('|')[1]&&M==E['Previous-Turn'].split('|')[0]||('x'==L?D.x_board.push(D.add.image(M*u/9+u/18,J*v/9+v/18,'x')):'o'==L&&D.o_board.push(D.add.image(M*u/9+u/18,J*v/9+v/18,'o')))})})}),this.input.on('pointerdown',function(E){if(D.players_turn){D.place_in_progress=!0;var F=E.y;F>v-1&&(F=v-1);var G=E.x,H={x:Math.floor(G/(u/9)),y:Math.floor(F/(v/9))};D.reapear_location_x=Math.floor(G/(u/9))*u/9+u/18,D.reapear_location_y=Math.floor(F/(u/9))*v/9+v/18,c.sendSocket('move',H)}}),this.input.on('pointermove',function(E){if(D.players_turn&&!1==D.place_in_progress){var F=E.y;F>v-1&&(F=v-1);var G=E.x,H={x:Math.floor(G/(u/9))*(u/9)+u/18,y:Math.floor(F/(v/9))*(v/9)+v/18};'x'==D.player_piece?(D.x_cursor_icon.x=H.x,D.x_cursor_icon.y=H.y):(D.o_cursor_icon.x=H.x,D.o_cursor_icon.y=H.y)}},this),c.sendSocket('ready',GameConstants.client_name)}function h(C){var D=this;console.log('press spec'),console.log(C),c.sendSocket('room-fill',GameConstants.client_name),this.info_text.x=900,this.play_text.x=900,this.spectate_text.x=900,c.socketListener('room-fill',function(E){console.log(E);var F=0;for(var H in E){var I=function(J){D.rooms_list_arr.push(D.add.text(30,(F+1)*30,E[J].Code,{fontSize:'22px',fill:'#fff'})),D.rooms_list_arr[F].setInteractive(),D.rooms_list_arr[F].on('pointerdown',function(){D.rooms_list_arr.forEach(function(K,L){D.rooms_list_arr[L].destroy()}),j(J,D)},D),F++};I(H)}},this)}function j(C,D){console.log(C),c.sendSocket('spectate-room',{client_name:GameConstants.client_name,room:C}),c.socketListener('spectate-join',function(){D.info_text.x=25,D.info_text.y=510,D.info_text.setText('Setting up game...'),D.board=D.add.image(250,250,'board'),D.x_cursor_icon=D.add.image(900,0,'x'),D.x_previous=D.add.image(900,0,'xG'),D.o_cursor_icon=D.add.image(900,0,'o'),D.o_previous=D.add.image(900,0,'oG'),D.move_sfx=D.sound.add('move'),D.lose_sfx=D.sound.add('win'),D.win_sfx=D.sound.add('lose'),c.socketListener('ready',function(){D.info_text.setText('Searching for players...'),D.info_text.x=10}),c.socketListener('disconnect',function(){D.info_text.setText('Game server is offline')}),c.socketListener('broken',function(){D.info_text.setText('Disconnected with other session')}),c.socketListener('board-data',function(F){var G=F['Previous-Turn'].split('|')[0]*u/9+u/18,H=F['Previous-Turn'].split('|')[1]*v/9+v/18;-1<F.Message.indexOf('wins')?D.win_sfx.play():'1'==F.Success&&D.move_sfx.play(),D.move_sfx.play(),'-'!=F['Previous-Turn']&&('x'==F.Turn?(D.x_cursor_icon.x=z,D.x_cursor_icon.y=A,D.o_previous.x=G,D.x_previous.x=-100,D.o_previous.y=H,D.x_previous.y=-100):(D.o_cursor_icon.x=z,D.o_cursor_icon.y=A,D.x_previous.x=G,D.o_previous.x=-100,D.x_previous.y=H,D.o_previous.y=-100)),D.info_text.setText('Turn '+F.Turn+' - Move '+F.Move),D.players_turn=!1,'x'==F.Turn?D.x_cursor_icon.visible=!1:D.o_cursor_icon.visible=!1,''!=F.Message&&D.info_text.setText(F.Message),D.x_board.forEach(function(J,K){D.x_board[K].destroy()}),D.o_board.forEach(function(J,K){D.o_board[K].destroy()});var I=F.Board.split('\n');I.forEach(function(J,K){var L=J.split(' ');L.forEach(function(M,N){K==F['Previous-Turn'].split('|')[1]&&N==F['Previous-Turn'].split('|')[0]||('x'==M?D.x_board.push(D.add.image(N*u/9+u/18,K*v/9+v/18,'x')):'o'==M&&D.o_board.push(D.add.image(N*u/9+u/18,K*v/9+v/18,'o')))})})}),c.sendSocket('spectate-connect',{client_name:GameConstants.client_name,room:C})},this)}var u=500,v=500,z=-100,A=-100,B={type:Phaser.AUTO,width:u,height:v+50,scene:{preload:function(){this.info_text=this.add.text(10,16,'building game...',{fontSize:'22px',fill:'#fff'}),this.load.image('board','sprites/board.jpg'),this.load.image('x','sprites/x.png'),this.load.image('xG','sprites/xG.png'),this.load.image('o','sprites/o.png'),this.load.image('oG','sprites/oG.png'),this.load.audio('start',['sfx/game-start.mp3']),this.load.audio('move',['sfx/move-done.mp3']),this.load.audio('win',['sfx/win-fx.mp3']),this.load.audio('lose',['sfx/lose-fx.mp3']),this.play_text=this.add.text(900,16,'Play',{fontSize:'32px',fill:'#fff'}),this.play_text.setInteractive(),this.play_text.on('pointerdown',g,this),this.spectate_text=this.add.text(900,100,'Spectate',{fontSize:'32px',fill:'#fff'}),this.spectate_text.setInteractive(),this.spectate_text.on('pointerdown',h,this)},create:function(){this.board=null,this.x_cursor_icon=null,this.x_previous=null,this.o_cursor_icon=null,this.o_previous=null,this.x_board=[],this.o_board=[],this.rooms_list_arr=[],this.game_start_sfx=null,this.move_sfx=null,this.lose_sfx=null,this.win_sfx=null,this.info_text.x=900,this.play_text.x=30,this.play_text.y=30,this.spectate_text.x=30,this.spectate_text.y=100,c.sendSocket('client-load',GameConstants.client_name)}},parent:'phaser-game'};new Phaser.Game(B)}}(),Chat=function(){function a(c,f){return this.main_chat_box=null,this.chat_socket=null,null==c?void console.log('chat_object NULL'):void(this.main_chat_box=c,this.chat_socket=f)}return a.prototype.initializeChat=function(c,f){var g=this;c.addEventListener('keydown',function(j){13===j.keyCode&&(g.chat_socket.sendSocket(f+'-client-message',{contents:c.value,sender:GameConstants.client_name}),c.value='')});var h=document.getElementById(f+'-username');h.textContent='<'+GameConstants.client_name+'('+GameConstants.socket_id.substr(0,4)+')>',h.addEventListener('click',function(){g.chat_socket.sendSocket(f+'-client-message',{contents:c.value,sender:GameConstants.client_name}),c.value=''})},a.prototype.addTextToChatbox=function(c,f,g,h){if(null==c)return void console.log('chat_list NULL');var j=document.createElement('LI');j.innerHTML='<div class=\'row\'>\n\t\t\t\t\t\t\t\t<div class=\'col-'+f+' border-right text-right text-truncate font-weight-bold\' style=\'opacity:1.0\'>&lt;'+h+'&gt;</div>\n\t\t\t\t\t\t\t\t<div class=\'col-'+(12-f)+' text-left\'>'+g+'</div>\n\t\t\t\t\t\t\t</div>',c.appendChild(j);var k=c.scrollHeight;c.scrollTo(0,k)},a.prototype.addServerMessageToChatbox=function(c,f){if(null==c)return void console.log('chat_list NULL');var g=document.createElement('LI');g.innerHTML='<li>\n\t\t\t\t\t\t\t\t<div class=\'col-12 px-4 py-2 text-left font-italic\'>'+f+'\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>',c.appendChild(g);var h=c.scrollHeight;c.scrollTo(0,h)},a}(),GlobalChat=function(a){function c(f,g){var h=this;return null==f?void console.log('chat_object NULL'):(h=a.call(this,f,g)||this,h.initializeChat(f.getElementsByTagName('INPUT')[0],'global'),h.handleGlobalChatMessages(),h.retrieveGlobalChatInfo(),h.fillBox(),h)}return __extends(c,a),c.prototype.handleGlobalChatMessages=function(){var f=this;this.chat_socket.socketListener('global-client-message',function(g){f.addTextToChatbox(f.main_chat_box.getElementsByTagName('UL')[1],2,g.contents,g.sender)})},c.prototype.retrieveGlobalChatInfo=function(){var f=this;this.chat_socket.socketListener('global-chat-setup',function(g){document.getElementById('global-count').textContent=g.length+' People Online';var h=f.main_chat_box.getElementsByTagName('UL')[0],j='<li><mark class=\'\' id=\'current-user\'>'+GameConstants.client_name+'('+GameConstants.socket_id.substr(0,4)+')</mark></li>';g.forEach(function(k){k==GameConstants.client_name+'('+GameConstants.socket_id.substr(0,4)+')'||(j+='<li><div>'+k+'</div></li>')}),h.innerHTML=j})},c.prototype.fillBox=function(){var f=this;this.chat_socket.socketListener('global-fill',function(g){var h='';g.forEach(function(k){h+='<li><div class=\'row\'>\n\t\t\t\t\t\t\t\t<div class=\'col-2 border-right text-right text-truncate font-weight-bold\' style=\'opacity:1.0\'>'+k.sender+'</div>\n\t\t\t\t\t\t\t\t<div class=\'col-'+10+' text-left\'>'+k.contents+'</div>\n\t\t\t\t\t\t\t</div></li>'}),f.main_chat_box.getElementsByTagName('UL')[1].innerHTML=h;var j=f.main_chat_box.getElementsByTagName('UL')[1].scrollHeight;f.main_chat_box.getElementsByTagName('UL')[1].scrollTo(0,j)}),this.chat_socket.sendSocket('global-fill','1')},c}(Chat),RoomChat=function(a){function c(f,g){var h=this;return null==f?void console.log('chat_object NULL'):(h=a.call(this,f,g)||this,h.initializeChat(f.getElementsByTagName('INPUT')[0],'room'),h.handleRoomMessages(),h.retrieveRoomChatInfo(),h)}return __extends(c,a),c.prototype.handleRoomMessages=function(){var f=this;this.chat_socket.socketListener('room-client-message',function(g){f.addTextToChatbox(f.main_chat_box.getElementsByTagName('UL')[0],4,g.contents,g.sender)}),this.chat_socket.socketListener('room-server-message',function(g){f.addServerMessageToChatbox(f.main_chat_box.getElementsByTagName('UL')[0],g.contents)})},c.prototype.retrieveRoomChatInfo=function(){this.chat_socket.socketListener('room-chat-setup',function(f){document.getElementById('room-name').textContent='GameID: '+f.Room;var g='';f.Viewers.forEach(function(h,j){return 0==j?void(g=h):void(g+=', '+h)}),document.getElementById('challengers').textContent=g})},c}(Chat),Settings=function(){return function(){document.getElementById('name-set').addEventListener('click',function(){document.cookie='code='+prompt('set new name(available on refresh): ',document.cookie.split('=')[1])})}}();function makeid(){for(var a='',c='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',f=0;5>f;f++)a+=c.charAt(Math.floor(Math.random()*c.length));return a}window.onload=function(){if(''==document.cookie){var a=prompt('message',makeid());''==a&&(a=makeid()),document.cookie='code='+a}GameConstants.client_name=document.cookie.split('=')[1];var c=new Socket;c.socketListener('connected',function(g){GameConstants.socket_id=g;var h=new RoomChat(document.getElementById('room-chat'),c),j=new GlobalChat(document.getElementById('global-chat'),c),k=new Settings}),c.socketListener('error',function(g){console.log(g),alert('Server had an error\n '+g)});new GameSettings(c)};