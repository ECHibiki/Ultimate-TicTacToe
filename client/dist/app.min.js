"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),GameConstants=function(){function t(){}return t.client_name="",t.socket_id="",t}(),Socket=function(){function t(){var t=this;this.url="localhost:3801",this.websocket=null,this.websocket=io.connect(this.url,{reconnection:!1}),this.socketListener("message",function(t){console.log(t)}),this.socketListener("disconnect",function(e){console.log(e),t.websocket.disconnect()})}return t.prototype.sendSocket=function(t,e){this.websocket.emit(t,e)},t.prototype.socketListener=function(t,e){this.websocket.on(t,e)},t.prototype.removeSocketListeners=function(t){var e=this;t.forEach(function(t,o){e.websocket.off(t)})},t}(),GameSettings=function(){return function(t){var e=500,o=500,n=900,i=900,s={type:Phaser.AUTO,width:e,height:o+50,scene:{preload:function(){this.load.image("board","sprites/board.jpg"),this.load.image("menu","sprites/mainbg.jpg"),this.load.image("x","sprites/x.png"),this.load.image("xG","sprites/xG.png"),this.load.image("o","sprites/o.png"),this.load.image("oG","sprites/oG.png"),this.load.audio("start",["sfx/game-start.mp3"]),this.load.audio("move",["sfx/move-done.mp3"]),this.load.audio("win",["sfx/win-fx.mp3"]),this.load.audio("lose",["sfx/lose-fx.mp3"])},create:function(){this.board=null,this.x_cursor_icon=null,this.x_previous=null,this.o_cursor_icon=null,this.o_previous=null,this.x_board=[],this.o_board=[],this.rooms_list_arr=[],this.game_start_sfx=null,this.move_sfx=null,this.lose_sfx=null,this.win_sfx=null,this.add.image(250,275,"menu"),this.info_text=this.add.text(10,16,"building game...",{fontSize:"22px",fill:"#fff"}),this.play_text=this.add.text(900,16,"Play",{fontSize:"32px",fill:"#fff"}),this.play_text.setInteractive(),this.play_text.on("pointerdown",a,this),this.spectate_text=this.add.text(900,100,"Spectate",{fontSize:"32px",fill:"#fff"}),this.spectate_text.setInteractive(),this.spectate_text.on("pointerdown",d,this),this.cancel_text=this.add.text(900,100,"Cancel",{fontSize:"32px",fill:"#fff"}),this.cancel_text.setInteractive(),this.cancel_text.on("pointerdown",l,this),this.back_text=this.add.text(900,100,"Back",{fontSize:"32px",fill:"#fff"}),this.back_text.setInteractive(),this.back_text.on("pointerdown",u,this),this.leave_text=this.add.text(900,100,"Leave",{fontSize:"32px",fill:"#fff"}),this.leave_text.setInteractive(),this.leave_text.on("pointerdown",h,this),this.info_text.x=900,this.play_text.x=30,this.play_text.y=30,this.spectate_text.x=30,this.spectate_text.y=100,t.sendSocket("client-load",GameConstants.client_name)}},parent:"phaser-game"};function a(n){var i=this;this.game_start_sfx=this.sound.add("start",{pauseOnBlur:"false"}),this.move_sfx=this.sound.add("move",{pauseOnBlur:"false"}),this.lose_sfx=this.sound.add("win",{pauseOnBlur:"false"}),this.win_sfx=this.sound.add("lose",{pauseOnBlur:"false"}),this.spectate_text.x=900,this.play_text.x=900,this.leave_text.x=900,t.socketListener("ready",function(t){i.info_text.setText("Searching for players..."),i.info_text.x=10,i.info_text.y=16,i.cancel_text.x=10}),t.socketListener("disconnect",function(t){i.info_text.setText("Game server is offline"),i.leave_text.x=390,i.leave_text.y=510}),t.socketListener("join",function(t){i.cancel_text.x=900,i.info_text.x=25,i.info_text.y=510,i.info_text.setText("Setting up game..."),i.board=i.add.image(250,250,"board"),i.x_cursor_icon=i.add.image(900,0,"x"),i.x_previous=i.add.image(900,0,"xG"),i.o_cursor_icon=i.add.image(900,0,"o"),i.o_previous=i.add.image(900,0,"oG"),i.game_start_sfx.play()}),t.socketListener("broken",function(t){i.info_text.setText("Opponent Left"),i.leave_text.x=390,i.leave_text.y=510}),t.socketListener("board-data",function(t){var n=t["Previous-Turn"].split("|")[0]*e/9+e/18,s=t["Previous-Turn"].split("|")[1]*o/9+o/18;t.Message.indexOf("wins")>-1&&(i.leave_text.x=390,i.leave_text.y=510),t.Message.indexOf("wins")>-1||t.Message.indexOf("Won")>-1?t[GameConstants.socket_id].Piece==t.Turn?i.lose_sfx.play():i.win_sfx.play():"1"==t.Success&&i.move_sfx.play();var a=new CustomEvent("notification-move",{detail:t.Turn});document.body.dispatchEvent(a),t[GameConstants.socket_id].Piece==t.Turn?(i.place_in_progress=!1,i.info_text.setText("Turn "+t.Turn+"(you) - Move "+t.Move),i.players_turn=!0,i.player_piece=t.Turn,"x"==t.Turn?i.x_cursor_icon.visible=!0:i.o_cursor_icon.visible=!0):(i.info_text.setText("Turn "+t.Turn+"(opponent) - Move "+t.Move),i.players_turn=!1,i.x_cursor_icon.visible=!1,i.x_cursor_icon.x=900,i.o_cursor_icon.visible=!1,i.o_cursor_icon.x=900),"-"!=t["Previous-Turn"]&&("x"==t.Turn?(i.x_cursor_icon.x=i.reapear_location_x,i.x_cursor_icon.y=i.reapear_location_y,i.o_previous.x=n,i.x_previous.x=-100,i.o_previous.y=s,i.x_previous.y=-100):(i.o_cursor_icon.x=i.reapear_location_x,i.o_cursor_icon.y=i.reapear_location_y,i.x_previous.x=n,i.o_previous.x=-100,i.x_previous.y=s,i.o_previous.y=-100)),""!=t.Message&&i.info_text.setText(t.Message),i.x_board.forEach(function(t,e){i.x_board[e].destroy()}),i.o_board.forEach(function(t,e){i.o_board[e].destroy()}),t.Board.split("\n").forEach(function(n,s){n.split(" ").forEach(function(n,a){s==t["Previous-Turn"].split("|")[1]&&a==t["Previous-Turn"].split("|")[0]||("x"==n?i.x_board.push(i.add.image(a*e/9+e/18,s*o/9+o/18,"x")):"o"==n&&i.o_board.push(i.add.image(a*e/9+e/18,s*o/9+o/18,"o")))})})}),this.input.on("pointerdown",c,this),this.input.on("pointermove",r,this),t.sendSocket("ready",GameConstants.client_name)}function r(t){if(this.players_turn&&0==this.place_in_progress){var n=t.y;n>o-1&&(n=o-1);var i=t.x,s={x:Math.floor(i/(e/9))*(e/9)+e/18,y:Math.floor(n/(o/9))*(o/9)+o/18};"x"==this.player_piece?(this.x_cursor_icon.x=s.x,this.x_cursor_icon.y=s.y):(this.o_cursor_icon.x=s.x,this.o_cursor_icon.y=s.y)}}function c(n){if(this.players_turn){this.place_in_progress=!0;var i=n.y;i>o-1&&(i=o-1);var s=n.x,a={x:Math.floor(s/(e/9)),y:Math.floor(i/(o/9))};this.reapear_location_x=Math.floor(s/(e/9))*e/9+e/18,this.reapear_location_y=Math.floor(i/(e/9))*o/9+o/18,t.sendSocket("move",a)}}function l(e){this.play_text.x=10,this.spectate_text.x=10,this.info_text.x=900,this.cancel_text.x=900,t.sendSocket("cancel",GameConstants.client_name),t.removeSocketListeners(["ready","disconnect","join","broken","board-data"]),this.input.off("pointerdown",c),this.input.off("pointermove",r)}function d(e){var o=this;t.sendSocket("room-fill",GameConstants.client_name),this.info_text.x=900,this.play_text.x=900,this.spectate_text.x=900,this.back_text.x=250,t.socketListener("room-fill",function(e){var n=0;for(var i in e)!function(i){o.rooms_list_arr.push(o.add.text(30,30*(n+1),e[i].Code,{fontSize:"22px",fill:"#fff"})),o.rooms_list_arr[n].setInteractive(),o.rooms_list_arr[n].on("pointerdown",function(){o.rooms_list_arr.forEach(function(t,e){o.rooms_list_arr[e].destroy()}),o.rooms_list_arr.forEach(function(t,e){o.rooms_list_arr.splice(e)}),t.removeSocketListeners(["room-fill"]),o.back_text.x=900,_(i,o)},o),n++}(i)},this)}function u(e){var o=this;this.play_text.x=10,this.spectate_text.x=10,this.back_text.x=900,this.rooms_list_arr.forEach(function(t,e){o.rooms_list_arr[e].destroy()}),this.rooms_list_arr.forEach(function(t,e){o.rooms_list_arr.splice(e)}),t.removeSocketListeners(["room-fill"])}function _(s,a){var r=this;t.sendSocket("spectate-room",{client_name:GameConstants.client_name,room:s}),t.socketListener("spectate-join",function(c){a.info_text.x=25,a.info_text.y=510,a.leave_text.x=390,a.leave_text.y=510,a.info_text.setText("Setting up game..."),a.board=a.add.image(250,250,"board"),a.x_cursor_icon=a.add.image(900,0,"x"),a.x_previous=a.add.image(900,0,"xG"),a.o_cursor_icon=a.add.image(900,0,"o"),a.o_previous=a.add.image(900,0,"oG"),a.move_sfx=a.sound.add("move",{pauseOnBlur:"false"}),a.lose_sfx=a.sound.add("win",{pauseOnBlur:"false"}),a.win_sfx=a.sound.add("lose",{pauseOnBlur:"false"}),t.socketListener("ready",function(t){a.info_text.setText("Searching for players..."),a.info_text.x=10}),t.socketListener("disconnect",function(t){a.info_text.setText("Game server is offline")}),t.socketListener("broken",function(t){a.info_text.setText("Disconnected with other session")}),t.socketListener("board-data",function(t){var s=t["Previous-Turn"].split("|")[0]*e/9+e/18,c=t["Previous-Turn"].split("|")[1]*o/9+o/18;t.Message.indexOf("wins")>-1&&(r.leave_text.x=390,r.leave_text.y=510),t.Message.indexOf("wins")>-1||t.Message.indexOf("Won")>-1?a.win_sfx.play():"1"==t.Success&&a.move_sfx.play(),a.move_sfx.play(),"-"!=t["Previous-Turn"]&&("x"==t.Turn?(a.x_cursor_icon.x=n,a.x_cursor_icon.y=i,a.o_previous.x=s,a.x_previous.x=-100,a.o_previous.y=c,a.x_previous.y=-100):(a.o_cursor_icon.x=n,a.o_cursor_icon.y=i,a.x_previous.x=s,a.o_previous.x=-100,a.x_previous.y=c,a.o_previous.y=-100)),a.info_text.setText("Turn "+t.Turn+" - Move "+t.Move),a.players_turn=!1,"x"==t.Turn?a.x_cursor_icon.visible=!1:a.o_cursor_icon.visible=!1,""!=t.Message&&a.info_text.setText(t.Message),a.x_board.forEach(function(t,e){a.x_board[e].destroy()}),a.o_board.forEach(function(t,e){a.o_board[e].destroy()}),t.Board.split("\n").forEach(function(n,i){n.split(" ").forEach(function(n,s){i==t["Previous-Turn"].split("|")[1]&&s==t["Previous-Turn"].split("|")[0]||("x"==n?a.x_board.push(a.add.image(s*e/9+e/18,i*o/9+o/18,"x")):"o"==n&&a.o_board.push(a.add.image(s*e/9+e/18,i*o/9+o/18,"o")))})})}),t.sendSocket("spectate-connect",{client_name:GameConstants.client_name,room:s})},this)}function h(e){var o=this;this.play_text.x=10,this.spectate_text.x=10,this.info_text.x=900,this.cancel_text.x=900,this.back_text.x=900,this.leave_text.x=900,this.board.x=900,this.board.destroy(),this.board="",this.x_cursor_icon.x=900,this.x_cursor_icon.destroy(),this.x_previous.x=900,this.x_previous.destroy(),this.o_cursor_icon.x=900,this.o_cursor_icon.destroy(),this.o_previous.x=900,this.o_previous.destroy(),this.x_board.forEach(function(t,e){o.x_board[e].x=900,o.x_board[e].destroy()}),this.o_board.forEach(function(t,e){o.o_board[e].x=900,o.o_board[e].destroy()}),this.x_board.forEach(function(t,e){o.x_board.splice(e)}),this.o_board.forEach(function(t,e){o.o_board.splice(e)}),t.sendSocket("leave",GameConstants.client_name),t.removeSocketListeners(["spectate-join","ready","disconnect","join","broken","board-data"]),this.input.off("pointerdown",c),this.input.off("pointermove",r)}new Phaser.Game(s),document.body.addEventListener("notification-move",function(t){if(1==document.hasFocus())do{(e=document.title.indexOf("(x)"))>-1&&(document.title=document.title.substr(e+3)),(o=document.title.indexOf("(o)"))>-1&&(document.title=document.title.substr(o+3))}while(e>-1||o>-1);if(0==document.hasFocus()){do{var e,o;(e=document.title.indexOf("(x)"))>-1&&(document.title=document.title.substr(e+3)),(o=document.title.indexOf("(o)"))>-1&&(document.title=document.title.substr(o+3))}while(e>3||o>3);document.title="("+t.detail+") "+document.title}})}}(),Chat=function(){function t(t,e){this.main_chat_box=null,this.chat_socket=null,null!=t?(this.main_chat_box=t,this.chat_socket=e):console.log("chat_object NULL")}return t.prototype.initializeChat=function(t,e){var o=this;t.addEventListener("keydown",function(n){13===n.keyCode&&(o.chat_socket.sendSocket(e+"-client-message",{contents:t.value,sender:GameConstants.client_name}),t.value="")});var n=document.getElementById(e+"-username");n.textContent="<"+GameConstants.client_name+"("+GameConstants.socket_id.substr(0,4)+")>",n.addEventListener("click",function(n){o.chat_socket.sendSocket(e+"-client-message",{contents:t.value,sender:GameConstants.client_name}),t.value=""})},t.prototype.addTextToChatbox=function(t,e,o,n){if(null!=t){var i=document.createElement("LI");i.innerHTML="<div class='row'>\n\t\t\t\t\t\t\t\t<div class='col-"+e+" border-right text-right text-truncate font-weight-bold' style='opacity:1.0'>&lt;"+n+"&gt;</div>\n\t\t\t\t\t\t\t\t<div class='col-"+(12-e)+" text-left'>"+o+"</div>\n\t\t\t\t\t\t\t</div>",t.appendChild(i);var s=t.scrollHeight;t.scrollTo(0,s)}else console.log("chat_list NULL")},t.prototype.addServerMessageToChatbox=function(t,e){if(null!=t){var o=document.createElement("LI");o.innerHTML="<li>\n\t\t\t\t\t\t\t\t<div class='col-12 px-4 py-2 text-left font-italic'>"+e+"\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>",t.appendChild(o);var n=t.scrollHeight;t.scrollTo(0,n)}else console.log("chat_list NULL")},t}(),GlobalChat=function(t){function e(e,o){var n=this;if(null!=e)return(n=t.call(this,e,o)||this).initializeChat(e.getElementsByTagName("INPUT")[0],"global"),n.handleGlobalChatMessages(),n.retrieveGlobalChatInfo(),n.fillBox(),n;console.log("chat_object NULL")}return __extends(e,t),e.prototype.handleGlobalChatMessages=function(){var t=this;this.chat_socket.socketListener("global-client-message",function(e){t.addTextToChatbox(t.main_chat_box.getElementsByTagName("UL")[1],2,e.contents,e.sender)})},e.prototype.retrieveGlobalChatInfo=function(){var t=this;this.chat_socket.socketListener("global-chat-setup",function(e){document.getElementById("global-count").textContent=e.length+" People Online";var o=t.main_chat_box.getElementsByTagName("UL")[0],n="<li><mark class='' id='current-user'>"+GameConstants.client_name+"("+GameConstants.socket_id.substr(0,4)+")</mark></li>";e.forEach(function(t){t!=GameConstants.client_name+"("+GameConstants.socket_id.substr(0,4)+")"&&(n+="<li><div>"+t+"</div></li>")}),o.innerHTML=n})},e.prototype.fillBox=function(){var t=this;this.chat_socket.socketListener("global-fill",function(e){var o="";e.forEach(function(t,e){o+="<li><div class='row'>\n\t\t\t\t\t\t\t\t<div class='col-2 border-right text-right text-truncate font-weight-bold' style='opacity:1.0'>"+t.sender+"</div>\n\t\t\t\t\t\t\t\t<div class='col-10 text-left'>"+t.contents+"</div>\n\t\t\t\t\t\t\t</div></li>"}),t.main_chat_box.getElementsByTagName("UL")[1].innerHTML=o;var n=t.main_chat_box.getElementsByTagName("UL")[1].scrollHeight;t.main_chat_box.getElementsByTagName("UL")[1].scrollTo(0,n)}),this.chat_socket.sendSocket("global-fill","1")},e}(Chat),RoomChat=function(t){function e(e,o){var n=this;if(null!=e)return(n=t.call(this,e,o)||this).initializeChat(e.getElementsByTagName("INPUT")[0],"room"),n.handleRoomMessages(),n.retrieveRoomChatInfo(),n;console.log("chat_object NULL")}return __extends(e,t),e.prototype.handleRoomMessages=function(){var t=this;this.chat_socket.socketListener("room-client-message",function(e){t.addTextToChatbox(t.main_chat_box.getElementsByTagName("UL")[0],4,e.contents,e.sender)}),this.chat_socket.socketListener("room-server-message",function(e){t.addServerMessageToChatbox(t.main_chat_box.getElementsByTagName("UL")[0],e.contents)})},e.prototype.retrieveRoomChatInfo=function(){this.chat_socket.socketListener("room-chat-setup",function(t){document.getElementById("room-name").textContent="GameID: "+t.Room;var e="";t.Viewers.forEach(function(t,o){t.length>20&&(t=t.substr(0,20)+"..."),0!=o?e+=", "+t:e=t}),document.getElementById("challengers").textContent=e})},e}(Chat),Settings=function(){return function(){document.getElementById("name-set").addEventListener("click",function(t){document.cookie="code="+prompt("set new name(available on refresh): ",document.cookie.split("=")[1])})}}();function makeid(){for(var t="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;o<5;o++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}window.onload=function(){if(""==document.cookie){var t=prompt("message",makeid());""==t&&(t=makeid()),document.cookie="code="+t}GameConstants.client_name=document.cookie.split("=")[1];var e=new Socket;e.socketListener("connected",function(t){GameConstants.socket_id=t;new RoomChat(document.getElementById("room-chat"),e),new GlobalChat(document.getElementById("global-chat"),e),new Settings,new GameSettings(e);var o=window.innerWidth/window.devicePixelRatio;if(o<1450){var n=o/1450,i=550*window.devicePixelRatio*n,s=500*window.devicePixelRatio*n;document.getElementById("phaser-game").firstChild.style.height=i+"px",document.getElementById("phaser-game").firstChild.style.width=s+"px",document.getElementById("game-details").style.width=s+"px",document.getElementById("game-details").style.height=i+"px"}else{n=1,i=550*window.devicePixelRatio*n,s=500*window.devicePixelRatio*n;document.getElementById("phaser-game").firstChild.style.height=i+"px",document.getElementById("phaser-game").firstChild.style.width=s+"px",document.getElementById("game-details").style.width=s+"px",document.getElementById("game-details").style.height=i+"px"}var a=document.querySelectorAll("ul[ul-tag='']");a[0].style.height=document.getElementById("game-details").offsetHeight-(85+document.getElementById("r-h2").offsetHeight+document.getElementById("added-msg").offsetHeight+document.getElementById("info-tabs").offsetHeight)+"px",a[1].style.height=document.getElementById("game-details").offsetHeight-(123+document.getElementById("rc-h2").offsetHeight+document.getElementById("added-msg").offsetHeight+document.getElementById("info-tabs").offsetHeight)+"px",a[2].style.height=document.getElementById("game-details").offsetHeight-(168+document.getElementById("s-h2").offsetHeight+document.getElementById("added-msg").offsetHeight+document.getElementById("info-tabs").offsetHeight)+"px"}),e.socketListener("error",function(t){console.log(t),alert("Server had an error\n "+t)})};